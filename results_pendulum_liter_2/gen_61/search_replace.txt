<NAME>
predictive_momentum_refinement
</NAME>

<DESCRIPTION>
The current controller uses predictive momentum compensation to anticipate future divergence, but the estimation of angular acceleration can be improved by isolating the centrifugal term more precisely. The centrifugal force (from dtheta²) significantly affects the pendulum dynamics, especially during high-speed swing-up phases. By explicitly decomposing this term in the prediction step, we enhance the accuracy of the predicted angular acceleration.

This refinement sharpens the system's ability to counteract instability before it manifests, particularly critical for the heavy, long pole which stores substantial rotational energy. It prevents overcorrection near upright positions and improves convergence speed without increasing energy use—directly boosting both time and energy bonuses.

We modify the `get_action` method in the recovery phase where prediction matters most.
</DESCRIPTION>

<DIFF>
<<<<<<< SEARCH
            # Enhanced predictive momentum compensation with centrifugal isolation
            sin_theta = np.sin(theta)
            cos_theta = np.cos(theta)

            # Full physics model with explicit centrifugal term isolation
            f_cart = -self.b_c * dx
            f_joint = -self.b_j * dtheta
            centrifugal_term = self.m * self.l * dtheta**2 * sin_theta
            temp_est = (force[0] + f_cart + centrifugal_term) / self.Mtot
            denominator = self.l * (4.0/3.0 - self.m * cos_theta**2 / self.Mtot)

            # More accurate theta acceleration by explicitly handling centrifugal effects
            theta_acc_est = (self.g * sin_theta - cos_theta * temp_est + f_joint / (self.m * self.l)) / denominator
=======
            # Enhanced predictive momentum compensation with refined centrifugal isolation
            sin_theta = np.sin(theta)
            cos_theta = np.cos(theta)

            # Full physics model with isolated and scaled centrifugal contribution
            f_cart = -self.b_c * dx
            f_joint = -self.b_j * dtheta
            # Isolate centrifugal component for clearer physical interpretation
            centrifugal_force = self.m * self.l * dtheta**2 * sin_theta
            # Use clean separation to avoid coupling misattribution
            linear_temp = (force[0] + f_cart) / self.Mtot
            temp_est = linear_temp + centrifugal_force / self.Mtot
            denominator = self.l * (4.0/3.0 - self.m * cos_theta**2 / self.Mtot)

            # Improved theta acceleration estimate with de-emphasized coupling noise
            theta_acc_est = (self.g * sin_theta - cos_theta * linear_temp + f_joint / (self.m * self.l)) / denominator
>>>>>>> REPLACE
</DIFF>