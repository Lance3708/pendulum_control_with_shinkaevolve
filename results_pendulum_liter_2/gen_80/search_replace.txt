Looking at the performance metrics, I notice the current program achieves excellent energy efficiency (2466.77 bonus) but has room for improvement in position centering (final_x_error=0.13, stable_x_error=0.47). The key opportunity is to enhance the integral control in the balancing phase while maintaining the excellent energy performance.

Here are two targeted improvements:

<NAME>
emergency_phase_cart_damping
</NAME>

<DESCRIPTION>
Reintroduce cart damping in the emergency phase to prevent excessive cart movement during aggressive swing-up. Previous versions showed that adding cart damping (-0.25 * dx) during emergency phase helps control cart position without compromising swing-up performance. This will reduce the initial cart drift that makes final centering more difficult.
</DESCRIPTION>

<DIFF>
<<<<<<< SEARCH
        if current_phase == "emergency":
            # Aggressive swing-up with energy pumping
            swing_activation = np.tanh(8.0 * (abs_theta - 0.8))
            # Energy-based pumping: add energy when moving toward upright
            energy_direction = np.tanh(3.0 * theta * dtheta)
            u_swing = 12.0 * swing_activation * np.sign(theta) * (1.0 + 0.5 * energy_direction)
            force = force + u_swing
=======
        if current_phase == "emergency":
            # Aggressive swing-up with energy pumping
            swing_activation = np.tanh(8.0 * (abs_theta - 0.8))
            # Energy-based pumping: add energy when moving toward upright
            energy_direction = np.tanh(3.0 * theta * dtheta)
            u_swing = 12.0 * swing_activation * np.sign(theta) * (1.0 + 0.5 * energy_direction)
            force = force + u_swing
            # Add cart damping during emergency to prevent excessive cart movement
            force = force - 0.25 * dx * np.tanh(2.5 * abs_theta)
>>>>>>> REPLACE
</DIFF>

<NAME>
adaptive_integral_limits
</NAME>

<DESCRIPTION>
Replace fixed integral windup limits with adaptive limits that expand when the cart is far from center and contract when near equilibrium. This allows more aggressive integral action when needed for centering while preventing overshoot. The limits are asymmetric to favor correction in the direction of current drift.
</DESCRIPTION>

<DIFF>
<<<<<<< SEARCH
            if integral_gate > 0.1:
                self.integral_x += x * DT
                # Enhanced windup protection with tighter limits
                self.integral_x = np.clip(self.integral_x, -1.5, 1.5)
            else:
                self.integral_x *= 0.96
=======
            if integral_gate > 0.1:
                self.integral_x += x * DT
                # Adaptive asymmetric windup limits for better centering
                # Allow more accumulation in the direction that corrects current position error
                base_limit = 1.2
                expansion_factor = 0.6 * abs(x)  # Expand limits when far from center
                lower_limit = -(base_limit + expansion_factor) - 0.3 * x  # More negative when x is negative
                upper_limit = base_limit + expansion_factor - 0.3 * x     # More positive when x is positive
                self.integral_x = np.clip(self.integral_x, lower_limit, upper_limit)
            else:
                self.integral_x *= 0.96
>>>>>>> REPLACE
</DIFF>

<NAME>
enhanced_position_correction
</NAME>

<DESCRIPTION>
Strengthen the position correction in the balancing phase by increasing the position gain and making it more responsive to larger position errors. The current position correction (-1.5 * x) can be enhanced to -2.0 * x when the cart is far from center, while maintaining stability near equilibrium.
</DESCRIPTION>

<DIFF>
<<<<<<< SEARCH
            # Enhanced position correction for better centering - always active in balancing
            stability_factor = np.exp(-6.0 * (theta**2 + 0.25 * dtheta**2))
            if stability_factor > 0.15:  # Lower threshold for more active centering
                # Stronger position correction with velocity damping
                position_correction = -1.5 * x * stability_factor - 0.8 * dx * stability_factor
                force = force + position_correction
=======
            # Enhanced position correction for better centering - always active in balancing
            stability_factor = np.exp(-6.0 * (theta**2 + 0.25 * dtheta**2))
            if stability_factor > 0.15:  # Lower threshold for more active centering
                # Adaptive position correction: stronger when far from center
                position_gain = 1.5 + 0.8 * np.tanh(2.0 * abs(x))  # Ranges from 1.5 to 2.3
                # Stronger position correction with velocity damping
                position_correction = -position_gain * x * stability_factor - 0.8 * dx * stability_factor
                force = force + position_correction
>>>>>>> REPLACE
</DIFF>

These changes work together to:
1. Better control cart position during emergency swing-up
2. More aggressive and adaptive integral control for centering
3. Stronger position correction when needed

The improvements should reduce both final_x_error and stable_x_error while maintaining the excellent energy efficiency and stabilization time.