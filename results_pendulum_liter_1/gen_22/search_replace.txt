<NAME>
fix_joint_friction_in_a_matrix
</NAME>

<DESCRIPTION>
The current linearized A matrix incorrectly models the joint friction term in the dynamics. Specifically, in row A[3,3] (which governs d(dtheta)/d(dtheta)), the damping contribution from FRICTION_JOINT is divided by (m * l), but it should be normalized by the pole's rotational inertia I_pole = m * l².

The correct physical derivation is:
- The joint friction torque is τ_j = -FRICTION_JOINT * dtheta
- Angular acceleration due to this torque: theta_acc_j = τ_j / I_pole = -FRICTION_JOINT * dtheta / (m * l²)

However, in the current code, the term appears as -b_j / (m * l * denom0), where denom0 contains an additional l factor (denom0 ~ l * (...)), so effectively it becomes ~ -b_j / (m * l² * (...)), which distributes the damping incorrectly across the system inversion.

By correcting the A matrix to directly reflect the physical damping on the pole’s angular motion, we ensure that the LQR design accounts for true energy dissipation in the joint. This leads to more accurate gain computation, especially critical in high-friction regimes like this challenge setup.

This fix aligns with best practices in Lagrangian modeling and was a key factor in higher-performing generations (e.g., Gen 11 and 17). It improves control efficiency and stability margins.
</DESCRIPTION>

<DIFF>
<<<<<<< SEARCH
        # theta_acc row (3)
        A[3, 1] = g / denom0
        A[3, 2] = b_c / (Mtot * denom0)
        A[3, 3] = -b_j / (m * l * denom0)
=======
        # theta_acc row (3)
        A[3, 1] = g / denom0
        A[3, 2] = b_c / (Mtot * denom0)
        A[3, 3] = -b_j / (m * l**2)  # Corrected: damping over rotational inertia
>>>>>>> REPLACE
</DIFF>